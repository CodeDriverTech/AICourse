---
trigger: always_on
description: 本规范为AI和开发者定义了一套代码审查（Code Review）流程和行为准则。代码审查是保障代码质量、促进知识共享和提升团队整体水平的关键环节。本指南明确了审查者和被审查者的责任，强调了审查应聚焦于代码的逻辑、结构、可读性和健壮性，而非个人风格。AI在被要求审查代码时，应扮演一个客观、严谨且富有建设性的审查者角色，遵循此规范提供反馈，以共同构建高质量、可维护的代码库。
---

# 规范：代码审查流程 (Code Review Process)

## 核心目标

- **提升代码质量**: 发现潜在的bug、逻辑错误和设计缺陷。
- **知识共享**: 帮助团队成员了解代码库的其他部分，分享最佳实践。
- **保持风格一致**: 确保所有代码都遵循已定义的规范。
- **共同成长**: 通过提供和接收反馈，提升所有开发者的技能。

---

## 1. 提交者（作者）的责任

在发起一个代码审查请求（如在GitHub上创建一个Pull Request）之前，你必须：

1.  **自我审查**: 仔细检查自己的代码，确保它能够正常工作，并且你已经尽力使其清晰、健壮。
2.  **确保CI通过**: 所有自动化检查（linter, tests）必须通过。一个CI失败的请求不应该被提交审查。
3.  **提供清晰的上下文**:
    - 使用`Conventional Commits`规范编写清晰的标题和描述。
    - 在描述中解释你“为什么”要这样修改，而不仅仅是“修改了什么”。
    - 如果有相关的任务卡片（Ticket），附上链接。
4.  **小而专注**: 尽可能保持每个审查请求小而专注。一个请求只做一件事。巨大的请求难以审查。

---

## 2. 审查者 (Reviewer) 的责任

作为审查者，你的目标是**帮助作者提升代码质量**，而不是证明自己更聪明。

### 2.1. 审查的重点

- **设计与逻辑**: 代码的设计是否合理？是否能正确地解决问题？是否存在逻辑漏洞或未处理的边界情况？
- **可读性与可维护性**: 代码是否清晰易懂？命名是否规范？函数是否遵循单一职责原则？其他开发者能否在未来轻松地维护它？
- **一致性**: 代码是否遵循了项目的所有规范（如`basic`, `modules`层定义的规范）？
- **测试**: 是否有足够的测试来覆盖修改的逻辑？测试本身是否编写良好？
- **安全性**: 是否引入了新的安全风险？

### 2.2. 不应关注的重点

- **个人编码风格**: 只要代码遵循项目统一的`Ruff`格式化规则，就不要对个人风格（如变量命名偏好、代码布局）提出主观性建议。**代码风格由工具保证，不由人保证。**

### 2.3. 提供反馈的准则

- **要具体**: 不要说“这里可以优化”，而要说“将这个for循环改为列表推导式可以使代码更简洁”。
- **要解释原因**: 在提出建议时，解释“为什么”这样更好，可以引用相关的规范或设计原则。
- **提出问题，而非命令**: 优先使用提问的方式。例如，用“你考虑过如果输入是`None`的情况吗？”代替“这里需要处理`None`值”。
- **区分要求与建议**:
  - **[必须] / [Required]**: 对于必须修改的问题（如bug、安全漏洞），明确指出。
  - **[建议] / [Optional]**: 对于可以改进但非强制的建议，明确标出，由作者决定是否采纳。
- **要及时**: 尽你所能及时完成审查，不要成为流程的瓶颈。
- **要友善和尊重**: 记住，你是在评论代码，而不是评论作者本人。

### 2.4. AI 作为审查者

当AI被要求审查代码时，它将严格扮演一个客观的审查者角色，并：
- **基于规范**: 所有反馈都将基于已定义的规范文档。
- **提供修复建议**: 对于发现的问题，AI会直接提供修改后的代码片段。
- **保持中立**: AI不会使用情绪化或主观的语言。